<!DOCTYPE html>
<!--
Any copyright is dedicated to the Public Domain.
http://creativecommons.org/publicdomain/zero/1.0/
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
</head>
<body>
<script type="text/javascript">
fetch('main.wasm').then(function(response) {
    response.arrayBuffer().then(function(buffer) {
        WebAssembly.compile(buffer).then(function(module) {

            const decoder = new TextDecoder("utf-8");
            const imports = {
                env: {
                    __play_with_js: function() {
                        return 42;
                    },
                    __console_log: function(str, len) {
                        console.log(decoder.decode(instance.exports.memory.buffer.slice(str, str + len)));
                    },
                },
            };

            WebAssembly.instantiate(module, imports).then(function(instance) {
                console.log('MEMORY SIZE BEFORE', instance.exports.memory.buffer.byteLength / 65536)
                console.log(instance.exports.do_something())
                console.log('MEMORY SIZE AFTER', instance.exports.memory.buffer.byteLength / 65536)
            });
        });
    });
});
</script>
</body>
</html>
